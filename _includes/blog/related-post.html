<div class="related">
{% assign maxRelated = 5 %}
{% assign minCommonTags =  1 %}
{% assign maxRelatedCounter = 0 %}
    

<h4 class="text-muted">Related Posts</h4>
<ul class="related-posts">
    {% for post in site.posts %}
    
    	{% assign sameTagCount = 0 %}
            {% assign commonTags = '' %}
    
		{% for tag in post.tags %}
        	{% if post.url != page.url %}
            	    {% if page.tags contains tag %}
            	        {% assign sameTagCount = sameTagCount | plus: 1 %}
            	    {% endif %}
                {% endif %}
		 {% endfor %}
    
        {% if sameTagCount >= minCommonTags %}
<li>
        <h3>
          <a href="{{ post.url }}">
            {{ post.title }}
            <small>{{ post.date | date_to_string }}</small>
          </a>
        </h3>
</li>
            {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
            
            {% if maxRelatedCounter >= maxRelated %}
                {% break %}
            {% endif %}
		{% endif %}
	{% endfor %}
</ul>
</div>
