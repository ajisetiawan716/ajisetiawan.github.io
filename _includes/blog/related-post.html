{% assign maxRelated = 4 %}
{% assign minCommonTags = 1 %}
{% assign maxRelatedCounter = 0 %}
{% assign relatedPostsFound = false %}
{% assign relatedPosts = "" %}

{% for post in site.posts %}
  {% assign sameTagCount = 0 %}
  {% for tag in post.tags %}
    {% if post.url != page.url and page.tags contains tag %}
      {% assign sameTagCount = sameTagCount | plus: 1 %}
    {% endif %}
  {% endfor %}
  {% if sameTagCount >= minCommonTags %}
    {% assign relatedPostsFound = true %}
    {% capture relatedPost %}
<div class="card" style="width: 18rem;">
<a href="{{ site.baseurl }}{{ post.url }}"> 
  {% if post.image or post.external-image %}
    {% include blog/related-post-image.html external-image=post.external-image image=post.image alt=post.image-alt %}
  {% endif %}
  <div class="card-body">
    <h5 class="card-title">{{ post.title }}</h5>
    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>  
  </div>
</a>
</div>
    {% endcapture %}
    {% assign relatedPosts = relatedPosts | append: relatedPost %}
    {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
    {% if maxRelatedCounter >= maxRelated %}
      {% break %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if relatedPostsFound %}
  <h2>Related Post</h2>
  <div class="rect">
    {{ relatedPosts }}
  </div>
{% endif %}
